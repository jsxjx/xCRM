{% load BlockTag %}
{% load BlockTag2 %}
{% load NavMenuTag %}
{% load NavMenuItemTag %}
{% load FormTag %}
{% load AuthRequireTag %}
{% load FieldSelectTag %}
{% load PhraseTag %}
{% load staticfiles %}

{##}
{#<script>#}
{#        function format(d) {#}
{#            var accountsHtml = ''#}
{#            if (d.accounts.length != 0) {#}
{#                for (i in d.accounts) {#}
{#                    accountsHtml += '<br>' + d.accounts[i].accountName + ':' + d.accounts[i].accountNumber#}
{#                    tableHtml = "<table class=\"table table-striped table-condensed table-bordered\"> \#}
{#                    <thead> \#}
{#                    <tr> \#}
{#                        <th width='20%'></th> \#}
{#                        <th width='20%'>本年</th> \#}
{#                        <th width='20%'>本季度</th> \#}
{#                        <th width='20%'>本月</th> \#}
{#                        <th width='20%'>本周</th> \#}
{#                    </tr> \#}
{#                    </thead> \#}
{#                    <tbody> \#}
{#                    <tr> \#}
{#                        <td>数量</td> \#}
{#                        <td>{0}</td> \#}
{#                        <td>{1}</td> \#}
{#                        <td>{2}</td> \#}
{#                        <td>{3}</td> \#}
{#                    </tr> \#}
{#                    <tr> \#}
{#                        <td>交易量</td> \#}
{#                        <td>{4}</td> \#}
{#                        <td>{5}</td> \#}
{#                        <td>{6}</td> \#}
{#                        <td>{7}</td> \#}
{#                    </tr> \#}
{#                    <tr> \#}
{#                        <td>山航交易量</td> \#}
{#                        <td>{8}</td> \#}
{#                        <td>{9}</td> \#}
{#                        <td>{10}</td> \#}
{#                        <td>{11}</td> \#}
{#                    </tr> \#}
{#                    </tbody> \#}
{#                </table>"#}
{##}
{#                    tableHtml = String.format(tableHtml,#}
{#                            '总：' + d.accounts[i].statistics.year.totalCount + '<br>订：' + d.accounts[i].statistics.year.totalDBCount + '<br>退：' + d.accounts[i].statistics.year.totalCRCount,#}
{#                            '总：' + d.accounts[i].statistics.season.totalCount + '<br>订：' + d.accounts[i].statistics.season.totalDBCount + '<br>退：' + d.accounts[i].statistics.season.totalCRCount,#}
{#                            '总：' + d.accounts[i].statistics.month.totalCount + '<br>订：' + d.accounts[i].statistics.month.totalDBCount + '<br>退：' + d.accounts[i].statistics.month.totalCRCount,#}
{#                            '总：' + d.accounts[i].statistics.week.totalCount + '<br>订：' + d.accounts[i].statistics.week.totalDBCount + '<br>退：' + d.accounts[i].statistics.week.totalCRCount,#}
{#                            '总：' + d.accounts[i].statistics.year.totalSum + '<br>订：' + d.accounts[i].statistics.year.totalDBSum + '<br>退：' + d.accounts[i].statistics.year.totalCRSum,#}
{#                            '总：' + d.accounts[i].statistics.season.totalSum + '<br>订：' + d.accounts[i].statistics.season.totalDBSum + '<br>退：' + d.accounts[i].statistics.season.totalCRSum,#}
{#                            '总：' + d.accounts[i].statistics.month.totalSum + '<br>订：' + d.accounts[i].statistics.month.totalDBSum + '<br>退：' + d.accounts[i].statistics.month.totalCRSum,#}
{#                            '总：' + d.accounts[i].statistics.week.totalSum + '<br>订：' + d.accounts[i].statistics.week.totalDBSum + '<br>退：' + d.accounts[i].statistics.week.totalCRSum,#}
{#                            '总：' + d.accounts[i].statistics.year.totalSHSum + '<br>订：' + d.accounts[i].statistics.year.totalSHDBSum + '<br>退：' + d.accounts[i].statistics.year.totalSHCRSum,#}
{#                            '总：' + d.accounts[i].statistics.season.totalSHSum + '<br>订：' + d.accounts[i].statistics.season.totalSHDBSum + '<br>退：' + d.accounts[i].statistics.season.totalSHCRSum,#}
{#                            '总：' + d.accounts[i].statistics.month.totalSHSum + '<br>订：' + d.accounts[i].statistics.month.totalSHDBSum + '<br>退：' + d.accounts[i].statistics.month.totalSHCRSum,#}
{#                            '总：' + d.accounts[i].statistics.week.totalSHSum + '<br>订：' + d.accounts[i].statistics.week.totalSHDBSum + '<br>退：' + d.accounts[i].statistics.week.totalSHCRSum#}
{#                    );#}
{#                    accountsHtml += '<br>' + tableHtml#}
{#                }#}
{#            } else {#}
{#                accountsHtml = '无'#}
{#            }#}
{##}
{#            return '山旅通账户信息：' + accountsHtml;#}
{#        }#}
{##}
{#        $(document).ready(function () {#}
{#            var dt = $('#{{ tableId }}').DataTable({     #}
{#                {% PhraseTag g_default dataTableComm %}  #}
{#                "aaSorting": [],#}
{#                "bDestroy": true,#}
{#                "processing": true,#}
{#                "serverSide": false,#}
{#                "ajax": {#}
{#                    url: '/sales/ajax?t=myorders',#}
{#                    dataSrc: '',#}
{#                    error: function(xhr, textStatus, error){ alert(error); }#}
{#                },#}
{#                "columns": [#}
{#                    {#}
{#                        "class": "details-control",#}
{#                        "orderable": false,#}
{#                        "data": null,#}
{#                        "defaultContent": "",#}
{#                        "width": '3%'#}
{#                    },#}
{#                    {"data": "shortName", "title": "{% PhraseTag order shortName %}", "width": '20%'},#}
{#                    {"data": "channel", "title": "{% PhraseTag order channel %}", "width": '10%'},#}
{#                    {"data": "stage", "title": "{% PhraseTag order stage %}", "width": '5%'},#}
{#                    {"data": "status", "title": "{% PhraseTag order status %}", "width": '5%'},#}
{#                    {"data": "travelAmount", "title": "{% PhraseTag order travelAmount %}", "width": '12%'},#}
{#                    {"data": "goLiveDate", "title": "{% PhraseTag order goLiveDate %}", "width": '10%'},#}
{#                    {"data": "latestText", "title": "{% PhraseTag order text %}", "width": '20%'},#}
{#                    {#}
{#                        "sortable": false,#}
{#                        "render": function (data, type, full, meta) {#}
{#                            return "<button type='button' class='btn btn-success btn-sm' onclick='javascript:toNav(\"commonOrder\",\"view\",\"" + full.id + "\")'><i class=\"glyphicon glyphicon-zoom-in icon-white\"></i></button>"#}
{#                        },#}
{#                        "title": "{% PhraseTag order operation %}",#}
{#                        "width": "5%"#}
{#                    }#}
{#                ]#}
{#            });#}
{##}
{#            // Array to track the ids of the details displayed rows#}
{#            var detailRows = [];#}
{##}
{#            $('#{{ tableId }} tbody').on('click', 'tr td.details-control', function () {#}
{#                var tr = $(this).closest('tr');#}
{#                var row = dt.row(tr);#}
{#                var idx = $.inArray(tr.attr('id'), detailRows);#}
{##}
{#                if (row.child.isShown()) {#}
{#                    tr.removeClass('details');#}
{#                    row.child.hide();#}
{##}
{#                    // Remove from the 'open' array#}
{#                    detailRows.splice(idx, 1);#}
{#                }#}
{#                else {#}
{#                    tr.addClass('details');#}
{#                    row.child(format(row.data())).show();#}
{##}
{#                    // Add to the 'open' array#}
{#                    if (idx === -1) {#}
{#                        detailRows.push(tr.attr('id'));#}
{#                    }#}
{#                }#}
{#            });#}
{##}
{#            // On each draw, loop over the `detailRows` array and show any child rows#}
{#            dt.on('draw', function () {#}
{#                $.each(detailRows, function (i, id) {#}
{#                    $('#' + id + ' td.details-control').trigger('click');#}
{#                });#}
{#            });#}
{#        });#}
{##}
{#        $(function () {#}
{#            $("#orderDelModal").on("show.bs.modal", function (event) {#}
{#                var button = $(event.relatedTarget)#}
{#                var modelId = button.data("whatever")#}
{#                var modal = $(this)#}
{#                $("#orderDelButton").on('click', function () {#}
{#                    toNav('deleteOrder', '', modelId)#}
{#                })#}
{#            });#}
{#        })#}
{#    </script>#}
{##}
{#<table id="{{ tableId }}"#}
{#               class="table table-striped table-condensed table-bordered bootstrap-datatable responsive"#}
{#               cellspacing="0" width="100%">#}
{#        </table>#}


<table id="{{ tableId }}" class=" table table-striped table-condensed table-bordered bootstrap-datatable datatable
       responsive">
<thead>
<tr>
    <th>{% PhraseTag order shortName %}</th>
    <th>{% PhraseTag order stage1cost %}</th>
    <th>{% PhraseTag order stage2cost %}</th>
    <th>{% PhraseTag order stage3cost %}</th>
    <th>{% PhraseTag order stage4cost %}</th>
    <th>{% PhraseTag order stage5cost %}</th>
</tr>
</thead>
<tbody>
{% for order in recordstatistic %}
    <tr>
        <td width='10%'><a
                href="javascript:toNav('commonOrder','view','{{ order.id }}')">{{ order.desc }}</a>
        </td>
        {% for stage in order.statistic %}
            <td width='10%'>
                {% if stage.visible %}
                    <span class="label-{{ stage.cssClass }} label label-default">
                            <i class="glyphicon glyphicon-{{ stage.icon }}"></i> {{ stage.daysDiff }}
                          </span>
                {% endif %}
            </td>
        {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>